<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ORA - –î—Ä—É–≥ –∏ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ (fixed)</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    body { font-family:'Inter',sans-serif; background:#0A0A0A; color:#fff; min-height:100vh }
    .container { max-width:390px; margin:0 auto; min-height:100vh; position:relative }
    .header { display:flex; justify-content:space-between; align-items:center; padding:16px 20px }
    .back-btn { background:none; border:none; color:#E5FF53; font-size:16px; font-weight:600; cursor:pointer }
    .header-title { flex:1; text-align:center }
    .header-title h1 { font-size:16px; font-weight:700 }
    .header-title p { font-size:12px; color:#9aa }
    .header-controls { display:flex; gap:12px }
    .header-btn { background:none; border:none; color:#E5FF53; font-size:14px; font-weight:600; cursor:pointer; padding:6px 8px; border-radius:6px }

    .main-content { padding:20px; margin-bottom:90px }

    .cards-grid { display:flex; flex-direction:column; gap:16px }
    .card { background:#1A1A1A; border-radius:10px; padding:20px; height:80px; display:flex; align-items:center; gap:16px; cursor:pointer }
    .card-ora { background:#E5FF53; color:#000 }
    .card-bible { background:#C7DCEF; color:#000 }
    .card-heroes { background:#3B3D53 }
    .card-mentor { background:#4E098E }
    .card-title { font-size:18px; font-weight:700 }
    .card-subtitle { font-size:14px; opacity:.9 }

    .screen { display:none }
    .screen.active { display:block }

    .selection-container { background:#1A1A1A; border-radius:12px; padding:20px; margin-bottom:20px }
    .selection-title { font-size:20px; font-weight:700; margin-bottom:16px; text-align:center }
    .selection-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px }
    .selection-item { background:#2A2A2A; border-radius:8px; padding:16px; text-align:center; cursor:pointer }
    .selection-item-title { font-weight:700 }
    .books-grid { display:grid; grid-template-columns:1fr; gap:8px; max-height:420px; overflow:auto }
    .book-item { background:#2A2A2A; border-radius:8px; padding:14px 16px; display:flex; justify-content:space-between; align-items:center; cursor:pointer }
    .book-name { font-size:16px; font-weight:600 }
    .book-chapters { font-size:12px; color:#aaa }

    .bible-reader { background:#1A1A1A; border-radius:12px; overflow:hidden }
    .book-header { background:#2A2A2A; padding:16px 20px; display:flex; justify-content:space-between; align-items:center }
    .book-title { font-weight:700 }
    .chapter-nav { background:#2A2A2A; padding:12px 20px; display:flex; justify-content:center; align-items:center; gap:20px; border-top:1px solid #333 }
    .chapter-btn { background:none; border:none; color:#E5FF53; font-size:18px; cursor:pointer; padding:8px; border-radius:6px }
    .chapter-info { font-weight:700 }
    .verses-container { padding:20px; line-height:1.6; max-height:420px; overflow:auto }
    .verse { margin-bottom:12px; padding:8px; border-radius:6px; cursor:pointer }
    .verse:hover { background:rgba(229,255,83,.05) }
    .verse.bookmarked { background:rgba(229,255,83,.12); border-left:3px solid #E5FF53; padding-left:12px }
    .verse-number { color:#E5FF53; font-weight:700; margin-right:8px }

    .loading-state,.error-state { text-align:center; padding:40px 20px }
    .loading-spinner { width:24px; height:24px; border:2px solid #333; border-top:2px solid #E5FF53; border-radius:50%; animation:spin 1s linear infinite; margin:0 auto 12px }
    @keyframes spin { to { transform:rotate(360deg) } }

    .tab-bar { position:fixed; bottom:0; left:50%; transform:translateX(-50%); width:372px; height:70px; background:#1A1A1A; border-radius:35px 35px 0 0; display:flex; justify-content:space-around; align-items:center }
    .tab-item{ display:flex; flex-direction:column; align-items:center; cursor:pointer; padding:8px }
    .tab-label{ font-size:10px; color:#888 }
    @media (max-width:390px){ .tab-bar{ width:100% } }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <button class="back-btn" id="back-btn" onclick="goBack()" style="display:none">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="header-title">
        <h1 id="header-title">ORA</h1>
        <p id="header-subtitle">–º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</p>
      </div>
      <div class="header-controls">
        <button class="header-btn" id="lang-btn" onclick="cycleLanguage()">RU</button>
        <button class="header-btn" onclick="showMenu()">...</button>
      </div>
    </div>

    <div class="main-content">
      <!-- HOME -->
      <div class="screen active" id="home-screen">
        <div class="cards-grid">
          <div class="card card-ora" onclick="comingSoon('ORA')">
            <div class="card-title">ORA</div>
            <div class="card-subtitle">–ú–æ–ª–∏—Ç–≤—ã –∏ –æ–±—â–µ–Ω–∏–µ</div>
          </div>
          <div class="card card-bible" onclick="openBible()">
            <div class="card-title">–ë–ò–ë–õ–ò–Ø</div>
            <div class="card-subtitle">–ß–∏—Ç–∞—Ç—å –∏ –∏–∑—É—á–∞—Ç—å</div>
          </div>
          <div class="card card-mentor" onclick="comingSoon('–ù–∞—Å—Ç–∞–≤–Ω–∏–∫')">
            <div class="card-title">–ù–ê–°–¢–ê–í–ù–ò–ö</div>
            <div class="card-subtitle">–ó–∞–º–µ—Ç–∫–∏ –∏ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã</div>
          </div>
          <div class="card card-heroes" onclick="comingSoon('–ì–µ—Ä–æ–∏')">
            <div class="card-title">–ì–ï–†–û–ò</div>
            <div class="card-subtitle">–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –ø–æ–¥—Ä–∞–∂–∞–Ω–∏—è</div>
          </div>
        </div>
      </div>

      <!-- TESTAMENT -->
      <div class="screen" id="testament-screen">
        <div class="selection-container">
          <h3 class="selection-title">üìú –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–≤–µ—Ç</h3>
          <div class="selection-grid">
            <div class="selection-item" onclick="selectTestament('old')">
              <div class="selection-item-title">–í–µ—Ç—Ö–∏–π –ó–∞–≤–µ—Ç</div>
              <div class="selection-item-subtitle">39 –∫–Ω–∏–≥</div>
            </div>
            <div class="selection-item" onclick="selectTestament('new')">
              <div class="selection-item-title">–ù–æ–≤—ã–π –ó–∞–≤–µ—Ç</div>
              <div class="selection-item-subtitle">27 –∫–Ω–∏–≥</div>
            </div>
          </div>
        </div>
      </div>

      <!-- BOOK -->
      <div class="screen" id="book-screen">
        <div class="selection-container">
          <h3 class="selection-title" id="book-screen-title">üìö –í—ã–±–µ—Ä–∏—Ç–µ –∫–Ω–∏–≥—É</h3>
          <div class="books-grid" id="books-grid"></div>
        </div>
      </div>

      <!-- CHAPTER -->
      <div class="screen" id="chapter-screen">
        <div class="selection-container">
          <h3 class="selection-title" id="chapter-screen-title">üìÑ –í—ã–±–µ—Ä–∏—Ç–µ –≥–ª–∞–≤—É</h3>
          <div class="selection-grid" id="chapters-grid"></div>
        </div>
      </div>

      <!-- TRANSLATION -->
      <div class="screen" id="translation-screen">
        <div class="selection-container">
          <h3 class="selection-title">üåç –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥</h3>
          <div class="selection-grid" id="translation-grid"></div>
        </div>
      </div>

      <!-- BIBLE READER -->
      <div class="screen" id="bible-screen">
        <div class="bible-reader" id="bible-reader" style="display:none">
          <div class="book-header">
            <div class="book-title" id="book-title"></div>
          </div>
          <div class="chapter-nav">
            <button class="chapter-btn" onclick="previousChapter()">‚Äπ</button>
            <div class="chapter-info" id="chapter-info"></div>
            <button class="chapter-btn" onclick="nextChapter()">‚Ä∫</button>
          </div>
          <div class="verses-container" id="verses-container"></div>
        </div>
        <div class="loading-state" id="loading-state" style="display:none">
          <div class="loading-spinner"></div>
          <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –ë–∏–±–ª–∏—é...</p>
        </div>
        <div class="error-state" id="error-state" style="display:none">
          <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç</p>
          <button class="chapter-btn" style="border:1px solid #E5FF53" onclick="retryLoad()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
      </div>
    </div>

    <!-- TABS -->
    <div class="tab-bar">
      <div class="tab-item" onclick="showScreen('home')">üè†<div class="tab-label">–î–æ–º–æ–π</div></div>
      <div class="tab-item" onclick="openBible()">üìñ<div class="tab-label">–ë–∏–±–ª–∏—è</div></div>
      <div class="tab-item" onclick="comingSoon('ORA')">üïäÔ∏è<div class="tab-label">ORA</div></div>
      <div class="tab-item" onclick="comingSoon('–ù–∞—Å—Ç–∞–≤–Ω–∏–∫')">üìÑ<div class="tab-label">–ù–∞—Å—Ç–∞–≤–Ω–∏–∫</div></div>
      <div class="tab-item" onclick="comingSoon('–ì–µ—Ä–æ–∏')">‚≠ê<div class="tab-label">–ì–µ—Ä–æ–∏</div></div>
    </div>
  </div>

  <script>
    // ===== CONFIG =====
    const BIBLE_TRANSLATIONS = {
      ru_synodal: { id:'ru_synodal', name:'–°–∏–Ω–æ–¥–∞–ª—å–Ω—ã–π', language:'ru', year:'1876', status:'ready' },
      en_kjv:     { id:'en_kjv', name:'King James', language:'en', year:'1611', status:'ready' },
      en_bbe:     { id:'en_bbe', name:'Basic English', language:'en', year:'1949', status:'ready' }
    };

    const BIBLE_BOOKS = {
      old:[
        { id:'gen', name:'–ë—ã—Ç–∏–µ', chapters:50 },
        { id:'exo', name:'–ò—Å—Ö–æ–¥', chapters:40 },
        { id:'psa', name:'–ü—Å–∞–ª—Ç–∏—Ä—å', chapters:150 }
      ],
      new:[
        { id:'mat', name:'–û—Ç –ú–∞—Ç—Ñ–µ—è', chapters:28 },
        { id:'mrk', name:'–û—Ç –ú–∞—Ä–∫–∞', chapters:16 },
        { id:'jhn', name:'–û—Ç –ò–æ–∞–Ω–Ω–∞', chapters:21 }
      ]
    };

    const DEMO_BIBLE_DATA = {
      ru_synodal: {
        gen: { name:'–ë—ã—Ç–∏–µ', chapters:[["–í –Ω–∞—á–∞–ª–µ —Å–æ—Ç–≤–æ—Ä–∏–ª –ë–æ–≥ –Ω–µ–±–æ –∏ –∑–µ–º–ª—é.","–ó–µ–º–ª—è –∂–µ –±—ã–ª–∞ –±–µ–∑–≤–∏–¥–Ω–∞ –∏ –ø—É—Å—Ç–∞...","–ò —Å–∫–∞–∑–∞–ª –ë–æ–≥: –¥–∞ –±—É–¥–µ—Ç —Å–≤–µ—Ç."]] },
        mrk: { name:'–ï–≤–∞–Ω–≥–µ–ª–∏–µ –æ—Ç –ú–∞—Ä–∫–∞', chapters:[["–ù–∞—á–∞–ª–æ –ï–≤–∞–Ω–≥–µ–ª–∏—è –ò–∏—Å—É—Å–∞ –•—Ä–∏—Å—Ç–∞, –°—ã–Ω–∞ –ë–æ–∂–∏—è,","–∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ —É –ø—Ä–æ—Ä–æ–∫–æ–≤...","–ì–ª–∞—Å –≤–æ–ø–∏—é—â–µ–≥–æ –≤ –ø—É—Å—Ç—ã–Ω–µ..."]] },
        mat: { name:'–ï–≤–∞–Ω–≥–µ–ª–∏–µ –æ—Ç –ú–∞—Ç—Ñ–µ—è', chapters:[ Array.from({length:25},(_,i)=>`–°—Ç–∏—Ö ${i+1} –∏–∑ –≥–ª–∞–≤—ã 1 (–°–∏–Ω–æ–¥.)`) ] }
      },
      en_kjv: {
        gen: { name:'Genesis', chapters:[["In the beginning God created the heaven and the earth.","And the earth was without form...","And God said, Let there be light..."]] },
        mrk: { name:'The Gospel According to Mark', chapters:[["The beginning of the gospel of Jesus Christ...","As it is written in the prophets...","The voice of one crying in the wilderness..."]] }
      },
      en_bbe: {
        mrk: { name:'Mark', chapters:[["The first words of the good news...","Even as it is said in Isaiah...","The voice of one crying in the waste land..."]] }
      }
    };

    // ===== STATE =====
    let currentScreen = 'home';
    let selectedTestament = '';
    let currentBook = '';
    let currentChapter = 1;
    let currentTranslation = 'ru_synodal';
    let currentLanguage = 'ru';
    let bibleData = {}; // translationId -> books
    const bookmarks = new Set();

    // ===== HELPERS =====
    function getAllBooks(){ return [...BIBLE_BOOKS.old, ...BIBLE_BOOKS.new]; }
    function getBookData(id){ return getAllBooks().find(b=>b.id===id); }
    function getBookName(id){ return (getBookData(id)||{}).name || '' }

    // ===== TELEGRAM INIT =====
    function initTelegram(){
      if(window.Telegram?.WebApp){
        const tg = window.Telegram.WebApp; tg.ready(); tg.expand();
        tg.BackButton.onClick(()=>goBack());
      }
    }

    // ===== NAVIGATION (SCREENS) =====
    function showScreen(name){
      document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
      document.getElementById(name+'-screen').classList.add('active');
      currentScreen = name; updateHeader(); updateBackButton();
    }
    function updateHeader(){
      const title = document.getElementById('header-title');
      const subtitle = document.getElementById('header-subtitle');
      if(currentScreen==='home'){ title.textContent='ORA'; subtitle.textContent='–º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ'; return }
      if(currentScreen==='testament'){ title.textContent='–ë–∏–±–ª–∏—è'; subtitle.textContent='–í—ã–±–æ—Ä –∑–∞–≤–µ—Ç–∞'; return }
      if(currentScreen==='book'){ title.textContent= selectedTestament==='old'?'–í–µ—Ç—Ö–∏–π –ó–∞–≤–µ—Ç':'–ù–æ–≤—ã–π –ó–∞–≤–µ—Ç'; subtitle.textContent='–í—ã–±–æ—Ä –∫–Ω–∏–≥–∏'; return }
      if(currentScreen==='chapter'){ title.textContent=getBookName(currentBook); subtitle.textContent='–í—ã–±–æ—Ä –≥–ª–∞–≤—ã'; return }
      if(currentScreen==='translation' || currentScreen==='bible'){ title.textContent=getBookName(currentBook); subtitle.textContent=`–ì–ª–∞–≤–∞ ${currentChapter}`; return }
    }
    function updateBackButton(){ document.getElementById('back-btn').style.display = currentScreen==='home'?'none':'block' }
    function goBack(){
      if(currentScreen==='testament') return showScreen('home');
      if(currentScreen==='book') return showScreen('testament');
      if(currentScreen==='chapter') return showScreen('book');
      if(currentScreen==='translation') return showScreen('chapter');
      if(currentScreen==='bible') return showScreen('translation');
    }

    // ===== FLOWS =====
    function openBible(){ showScreen('testament'); }
    function selectTestament(t){ selectedTestament=t; renderBooks(); showScreen('book'); }
    function selectBook(bookId){ currentBook=bookId; renderChapters(); showScreen('chapter'); }
    function selectChapter(ch){ currentChapter=ch; renderTranslations(); showScreen('translation'); }

    // ===== RENDERERS =====
    function renderBooks(){
      const title=document.getElementById('book-screen-title');
      const grid=document.getElementById('books-grid');
      title.textContent = selectedTestament==='old' ? 'üìú –í–µ—Ç—Ö–∏–π –ó–∞–≤–µ—Ç' : 'üìï –ù–æ–≤—ã–π –ó–∞–≤–µ—Ç';
      grid.innerHTML='';
      (BIBLE_BOOKS[selectedTestament]||[]).forEach(b=>{
        const el=document.createElement('div'); el.className='book-item'; el.onclick=()=>selectBook(b.id);
        el.innerHTML=`<div class="book-name">${b.name}</div><div class="book-chapters">${b.chapters} –≥–ª–∞–≤</div>`;
        grid.appendChild(el);
      });
    }
    function renderChapters(){
      const title=document.getElementById('chapter-screen-title');
      const grid=document.getElementById('chapters-grid');
      const book=getBookData(currentBook); title.textContent=`üìÑ ${book.name}`; grid.innerHTML='';
      for(let i=1;i<=book.chapters;i++){
        const el=document.createElement('div'); el.className='selection-item'; el.onclick=()=>selectChapter(i);
        el.innerHTML=`<div class="selection-item-title">–ì–ª–∞–≤–∞ ${i}</div>`; grid.appendChild(el);
      }
    }
    function renderTranslations(){
      const grid=document.getElementById('translation-grid'); grid.innerHTML='';
      Object.values(BIBLE_TRANSLATIONS).forEach(t=>{
        const el=document.createElement('div'); el.className='selection-item';
        if(t.status==='ready'){ el.onclick=()=>selectTranslation(t.id); }
        el.innerHTML=`<div class="selection-item-title">${t.name}</div><div class="selection-item-subtitle">${t.language.toUpperCase()} ¬∑ ${t.year}</div>`;
        if(t.id===currentTranslation) el.style.outline='2px solid #E5FF53';
        grid.appendChild(el);
      });
    }

    // ===== TRANSLATION / DATA =====
    function selectTranslation(id){
      const t=BIBLE_TRANSLATIONS[id]; if(!t || t.status!=='ready') return;
      currentTranslation=id; currentLanguage=t.language; document.getElementById('lang-btn').textContent=t.language.toUpperCase();
      loadBibleData(id);
    }
    function loadBibleData(id){
      showLoading();
      setTimeout(()=>{
        try{
          bibleData[id] = DEMO_BIBLE_DATA[id] || {};
          // generate demo if missing chosen book
          if(!bibleData[id][currentBook]){
            const b=getBookData(currentBook); const chapters=[];
            for(let c=1;c<=Math.min(b.chapters,3);c++){
              const vCount=c===1?20:15; const verses=[];
              for(let i=1;i<=vCount;i++) verses.push( (currentLanguage==='ru')?`–°—Ç–∏—Ö ${i} –∏–∑ ${c} –≥–ª–∞–≤—ã –∫–Ω–∏–≥–∏ "${b.name}" (${BIBLE_TRANSLATIONS[id].name})`:`Verse ${i} from chapter ${c} of "${b.name}" (${BIBLE_TRANSLATIONS[id].name})` );
              chapters.push(verses);
            }
            bibleData[id][currentBook] = { name:b.name, chapters };
          }
          displayBibleReader();
        }catch(e){ showError(); console.error(e); }
      }, 500);
    }

    // ===== READER =====
    function showLoading(){
      document.getElementById('bible-reader').style.display='none';
      document.getElementById('loading-state').style.display='block';
      document.getElementById('error-state').style.display='none';
      showScreen('bible');
    }
    function showError(){
      document.getElementById('bible-reader').style.display='none';
      document.getElementById('loading-state').style.display='none';
      document.getElementById('error-state').style.display='block';
      showScreen('bible');
    }
    function displayBibleReader(){
      document.getElementById('loading-state').style.display='none';
      document.getElementById('error-state').style.display='none';
      document.getElementById('bible-reader').style.display='block';
      displayCurrentChapter();
    }
    function displayCurrentChapter(){
      const bookData = bibleData[currentTranslation]?.[currentBook]; if(!bookData) return;
      document.getElementById('book-title').textContent=bookData.name;
      document.getElementById('chapter-info').textContent=`–ì–ª–∞–≤–∞ ${currentChapter}`;
      const verses = bookData.chapters[currentChapter-1] || [];
      const container=document.getElementById('verses-container'); container.innerHTML='';
      verses.forEach((t,i)=>{
        const v=document.createElement('div'); v.className='verse'; v.onclick=()=>toggleBookmark(currentBook,currentChapter,i+1);
        const id=`${currentBook}-${currentChapter}-${i+1}`; if(bookmarks.has(id)) v.classList.add('bookmarked');
        v.innerHTML=`<span class='verse-number'>${i+1}</span><span class='verse-text'>${t}</span>`; container.appendChild(v);
      });
    }
    function previousChapter(){ if(currentChapter>1){ currentChapter--; displayCurrentChapter(); updateHeader(); } }
    function nextChapter(){ const len = (bibleData[currentTranslation]?.[currentBook]?.chapters || []).length; if(currentChapter<len){ currentChapter++; displayCurrentChapter(); updateHeader(); } }
    function toggleBookmark(book,chapter,verse){ const id=`${book}-${chapter}-${verse}`; bookmarks.has(id)?bookmarks.delete(id):bookmarks.add(id); displayCurrentChapter(); }
    function retryLoad(){ loadBibleData(currentTranslation); }

    // ===== UI MISC =====
    function cycleLanguage(){
      const langs=['ru','en']; const i=langs.indexOf(currentLanguage); const next=langs[(i+1)%langs.length];
      const candidate = Object.values(BIBLE_TRANSLATIONS).find(t=>t.language===next && t.status==='ready');
      if(candidate) selectTranslation(candidate.id);
    }
    function comingSoon(name){ alert(`${name} ‚Äî —Ä–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ üöÄ`); }
    function showMenu(){ alert('–ú–µ–Ω—é: –ó–∞–∫–ª–∞–¥–∫–∏, –ü–æ–∏—Å–∫, –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äî —Å–∫–æ—Ä–æ!'); }

    // START
    document.addEventListener('DOMContentLoaded', ()=>{ initTelegram(); });
  </script>
</body>
</html>
